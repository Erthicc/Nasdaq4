(async function(){const metaEl=document.getElementById('meta');const genEl=document.getElementById('generated_at');const summaryEl=document.getElementById('summary');const tbody=document.querySelector('#results tbody');const search=document.getElementById('search');const topN=document.getElementById('topN');async function loadData(){try{const res=await fetch('top_picks.json',{cache:'no-store'});if(!res.ok)throw new Error('Fetch error '+res.status);const j=await res.json();metaEl.textContent=`Scores: ${j.count_results||0} results (attempted ${j.count_total||0})`;genEl.textContent=j.generated_at||'';render(j.top||[]);}catch(err){metaEl.textContent='Error loading top_picks.json: '+err;console.error(err);}}function render(items){const limit=Math.max(1,Math.min(500,parseInt(topN.value||50)));const q=(search.value||'').toLowerCase().trim();let shown=0;tbody.innerHTML='';for(let i=0;i<items.length&&shown<limit;i++){const it=items[i];const txt=(it.ticker+' '+(it.explanation||'')).toLowerCase();if(q&& !txt.includes(q)) continue;const tr=document.createElement('tr');const rankTd=document.createElement('td');rankTd.textContent=(i+1);const tickerTd=document.createElement('td');tickerTd.textContent=it.ticker;const scoreTd=document.createElement('td');scoreTd.textContent=it.score_0_100;const lastTd=document.createElement('td');lastTd.textContent=(it.last_close||'').toString();const volTd=document.createElement('td');volTd.textContent=(it.avg_vol20||'').toString();const explTd=document.createElement('td');explTd.textContent=it.explanation||'';tr.appendChild(rankTd);tr.appendChild(tickerTd);tr.appendChild(scoreTd);tr.appendChild(lastTd);tr.appendChild(volTd);tr.appendChild(explTd);tbody.appendChild(tr);shown++;}summaryEl.textContent=`Showing ${shown} of ${items.length} tickers`;}search.addEventListener('input',()=>loadData());topN.addEventListener('change',()=>loadData());await loadData();})();